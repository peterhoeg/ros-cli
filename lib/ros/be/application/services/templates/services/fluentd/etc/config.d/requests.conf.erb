# request logging is a platform concern
# ETL of records is based on format of logs as configured in rack-fluentd configuration in core lib
<%= @service.fluentd.header %>
    <filter <%= @service.fluentd.log_tag %>>
      @type record_modifier
      # write a temporary field _unix_time
      <record>
        _unix_time ${Time.parse(record['request']['time']).to_i}
      </record>
    </filter>

    <filter <%= @service.fluentd.log_tag %>>
      @type record_transformer
      enable_ruby true
      renew_time_key _unix_time
      remove_keys _unix_time
    </filter>

    <match <%= @service.fluentd.log_tag %>>
      @type kafka_buffered
      brokers <%= @service.fluentd.kafka_brokers %>
      default_topic http_request_log
      
    </match>
