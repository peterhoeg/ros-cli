# IAM event log source "events-log.iam"
<filter events-log.**>
  @type base64_decode
  fields data
</filter>

<match events-log.**>
  @type kafka2  
  brokers kafkastack:9092
  default_topic events-log
  message_key_key id  
  headers_from_record { "ce_specversion":"$.specversion", 
                        "ce_type":"$.type", 
                        "ce_source":"$.source", 
                        "ce_id":"$.id", 
                        "ce_time":"$.time", 
                        "ce_datacontenttype":"$.datacontenttype", 
                        "ce_schemaurl":"$.schemaurl", 
                        "ce_subject":"$.subject" 
                      }

  <format>
    @type single_value
    add_newline false
    message_key data
  </format>

  <buffer>
    @type file
    path /fluentd/log/buffer
    flush_interval 3s
  </buffer>    
</match>
