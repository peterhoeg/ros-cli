#!/usr/bin/env ruby

if ARGV[0]&.eql? '-T'
  res = %x(rake -T #{ARGV[1]})
  STDOUT.puts res.gsub(/^rake/, 'ros').gsub("\nrake", "\nros")
elsif ARGV[0]&.include? ':'
  require 'rake'
  tasks = ARGV.each_with_object([]) { |arg, tasks| tasks.append(arg) if arg.index(':') }
  args = ARGV.each_with_object([]) { |arg, args| args.append(arg) unless arg.index(':') }
  Rake.load_rakefile('Rakefile') if File.exists?('Rakefile')
  tasks.each { |task| Rake::Task[task].invoke(args) }
else
  require 'bundler/setup'
  require 'ros'
  arg = ARGV[0]
  if %w(be fe data).include?(arg)
    ARGV.shift
    if arg.eql?('be') and ARGV[0].eql?('infra')
      ARGV.shift
      require "ros/#{arg}/infra/cli"
      Ros.const_get("#{arg.capitalize}::Infra::Cli").start
    else
      require "ros/#{arg}/application/cli"
      Ros.const_get("#{arg.capitalize}::Application::Cli").start
    end
  else
    require 'ros/cli'
    Ros::Cli.start
  end
end
